[
  {
    "objectID": "new_code2.html",
    "href": "new_code2.html",
    "title": "Modeling of yield losses caused by the corn stunt disease complex",
    "section": "",
    "text": "Dependencies\nLet’s load all the packages we will use in the analyses below. Make sure all packages are installed beforehand. If you don’t have them installed yet, you can install them from the CRAN repository.\n\nlibrary(tidyverse)\nlibrary(gsheet)\nlibrary(ggplot2)\nlibrary(patchwork)\nlibrary(ggthemes)\nlibrary(metafor)\nlibrary(psych)\nlibrary(broom)\nlibrary(lme4)\nlibrary(car)\n\n\n\nData import\nFirst, we import two datasets from Google Sheets. cs_data contains the main dataset, while tabela2 includes additional information for joining.\nFirst, we import two datasets from Google Sheets. cs_data contains the main dataset, while tabela2 includes additional information for joining. Next, we filter the data to remove rows with missing values and high total spots, and adjust the dataset for the subsequent analyses.\nSince the severity scale does not include zero and a score of one represents the absence of the disease, we subtract 1 from the scale so that disease-free cases correspond to 0. This adjustment ensures that the intercept represents the attainable yield.\n\ncs_data &lt;- gsheet2tbl(\n  \"https://docs.google.com/spreadsheets/d/1Q6ES9jfpAwq1apyz7OpyT4X3aYyN_gSyFPkg9x6xar4/edit?gid=0#gid=0\")\ntabela2 &lt;- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1Q6ES9jfpAwq1apyz7OpyT4X3aYyN_gSyFPkg9x6xar4/edit?gid=1802319739#gid=1802319739\")\n\nexp1 &lt;- cs_data |&gt; \n  filter(!is.na(prod),\n         !is.na(enfez),\n         enfez &lt;= 6,\n         manchas_totais &lt; 5) |&gt; \n  mutate(prod_class = ifelse(prod &gt; 6377, \"alta\", \"baixa\")) |&gt; \n  left_join(tabela2, by = \"cultivar\")\n\n\nsev_dif &lt;- exp1 |&gt; \n  mutate(enfez = enfez - 1)\n\n\ndata1 &lt;- sev_dif |&gt; \n  group_by(estudo, tolerance_ad, cultivar, rep, cidade, ano, ensaio, prod_class, manchas_totais) |&gt; \n  summarize(prod = prod,\n            sev = enfez) |&gt; \n  mutate(trial = interaction(cidade, ano, ensaio)) \n\n\n\nExploratory Data Analysis\nExploratory analyses were performed to check the data distribution. We used histograms and boxplots to provide a better description and visualization of the data.\n\nMedian\n\nef_median &lt;- exp1 |&gt; \n  group_by(estudo, ano, cultivar) |&gt; \n  summarise(mean_sev = mean(enfez),\n            mean_yld = mean(prod),\n            median_sev = median(enfez),\n            median_prod = median(prod))\n\n\nef_median |&gt; \n  group_by(ano) |&gt; \n  summarise(median_sev = mean(median_sev),\n            median_prod = mean(median_prod))\n\n# A tibble: 2 × 3\n    ano median_sev median_prod\n  &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;\n1  2022       4.31       3406.\n2  2023       3.30       7722.\n\n\n\nsummary(ef_median)\n\n     estudo           ano         cultivar            mean_sev    \n Min.   : 1.00   Min.   :2022   Length:645         Min.   :1.500  \n 1st Qu.: 9.00   1st Qu.:2022   Class :character   1st Qu.:2.750  \n Median :15.00   Median :2023   Mode  :character   Median :3.500  \n Mean   :13.57   Mean   :2023                      Mean   :3.637  \n 3rd Qu.:19.00   3rd Qu.:2023                      3rd Qu.:4.500  \n Max.   :22.00   Max.   :2023                      Max.   :6.000  \n    mean_yld       median_sev     median_prod   \n Min.   :   30   Min.   :1.500   Min.   :   30  \n 1st Qu.: 3883   1st Qu.:2.750   1st Qu.: 3883  \n Median : 6377   Median :3.500   Median : 6377  \n Mean   : 6270   Mean   :3.637   Mean   : 6270  \n 3rd Qu.: 8692   3rd Qu.:4.500   3rd Qu.: 8692  \n Max.   :13500   Max.   :6.000   Max.   :13500  \n\n\n\n\nHistogram\n\ndist_sev &lt;- ef_median |&gt;\n  ggplot(aes(median_sev)) +\n  geom_histogram(bins = 10, \n                 fill = \"#3A5FCD\",\n                 color = \"darkblue\",\n                 linewidth = 0.5) +\n  labs(x = \"Severity  score\", y = \"\") +\n  geom_vline(xintercept = 3.637, size = 1.3, linetype = 2)+\n  theme_bw()\n\n\ndist_prod&lt;- ef_median |&gt;\n  ggplot(aes(median_prod)) +\n  geom_histogram(bins = 20, fill = \"#3A5FCD\",\n                 color = \"darkblue\",\n                 linewidth = 0.5) +\n  labs(x = \"Yield (kg/ha)\", y = \"\") +\n   geom_vline(xintercept = 6270, size = 1.3, linetype = 2)+\n  theme_bw()\n\n\n\nBoxplot\n\nbox_sev &lt;- ef_median |&gt;\n  ggplot(aes(factor(ano), median_sev)) +\n  geom_boxplot(outlier.shape = NA, fill = \"#3A5FCD\", color = \"darkblue\") +\n  theme_bw() +\n  labs(x = \"Second crop season\", y = \"Severity score\")\n\n\n\nbox_prod&lt;- ef_median |&gt;\n  ggplot(aes(factor(ano), median_prod)) +\n  geom_boxplot(outlier.shape = NA, fill = \"#3A5FCD\", color = \"darkblue\") +\n  theme_bw() +\n  labs(x = \"Second crop season\", y = \"Yield (kg/ha)\")\n\nFinal figure used in the article.\n\nFig2 &lt;- (dist_sev | box_sev)/\n(dist_prod | box_prod) +\n  plot_annotation(tag_levels = \"A\")\nFig2\n\n\n\n\n\n\n\n\n\n\nIndividual regressions\nIndividual regression analyses were performed for each of the 22 studies to examine the trend in the relationship between the two variables (CSCD severity and corn yield).\n\ngc1 &lt;- ef_median |&gt; \n  ggplot(aes(mean_sev, mean_yld))+\n  geom_smooth(method = \"lm\", se = FALSE, color = \"#3A5FCD\", fullrange = TRUE) +\n  geom_point(color = \"black\", shape = 1) + \n  theme_bw() +\n  facet_wrap(~estudo,\n             ncol = 6) +\n  labs(y = \"Yield (Kg/ha)\",x = \"Severity score\")\n\ngc1\n\n\n\n\n\n\n\n\n\n\nIndividual correlation\nWe also performed individual correlation analyses for the 22 studies and applied the Fisher Z-transformation.\n\ncorrelation_data &lt;- data1 |&gt; \n  group_by(estudo) |&gt; \n  summarise(r_sev_yld = cor(sev, prod), \n            n = n(), \n            Z_sev_yld = 0.5*log((1+r_sev_yld)/(1-r_sev_yld)), \n            V = 1/(n-3), \n            vd_sev_yld = 1/(2*(1-r_sev_yld)/n-3)) |&gt;  \n  filter(r_sev_yld != \"NA\") |&gt; \n  filter(n &gt; 4)\n\n\nsummary(correlation_data)\n\n     estudo        r_sev_yld             n          Z_sev_yld      \n Min.   : 1.00   Min.   :-0.9418   Min.   : 6.0   Min.   :-1.7540  \n 1st Qu.: 6.00   1st Qu.:-0.7831   1st Qu.:21.0   1st Qu.:-1.0533  \n Median :11.00   Median :-0.6022   Median :71.0   Median :-0.6966  \n Mean   :11.48   Mean   :-0.6283   Mean   :57.1   Mean   :-0.8261  \n 3rd Qu.:17.00   3rd Qu.:-0.5537   3rd Qu.:83.0   3rd Qu.:-0.6238  \n Max.   :22.00   Max.   :-0.1853   Max.   :88.0   Max.   :-0.1875  \n       V             vd_sev_yld     \n Min.   :0.01176   Min.   :-0.4225  \n 1st Qu.:0.01250   1st Qu.:-0.3552  \n Median :0.01471   Median :-0.3388  \n Mean   :0.04942   Mean   :-0.3486  \n 3rd Qu.:0.05556   3rd Qu.:-0.3374  \n Max.   :0.33333   Max.   :-0.3365  \n\n\nIndividual values were plotted to improve visualization.\n\nr &lt;- correlation_data %&gt;% \n  ggplot(aes(r_sev_yld)) +\n  geom_histogram(bins = 10,\n                 color = \"black\",\n                 fill = \"grey85\",\n                 alpha = 0.5,\n                 linewidth = 1) +\n  theme_bw()+\n  ylab(\"Frequency\") +\n  xlab(expression(\"Pearson's coefficient\")) +\n    theme(\n    axis.title.x = element_text(size = 20), \n    axis.title.y = element_text(size = 20), \n    axis.text.x = element_text(size = 16),   \n    axis.text.y = element_text(size = 16))\n\nz &lt;- correlation_data %&gt;% \n  ggplot(aes(Z_sev_yld))+\n  geom_histogram(bins = 10,\n                 color = \"black\",\n                 fill = \"grey85\",\n                 alpha = 0.5,\n                 linewidth = 1) +\n  theme_bw()+\n  ylab(\"Frequency\") +\n  xlab(expression(\"Fisher's \" * \"\" * italic(Z) * \"\")) +\n    theme(\n    axis.title.x = element_text(size = 20), \n    axis.title.y = element_text(size = 20), \n    axis.text.x = element_text(size = 16),   \n    axis.text.y = element_text(size = 16))\n\n\nfit_all &lt;- sev_dif |&gt; \n  group_by(estudo) |&gt; \n  do(tidy(lm(.$prod ~ .$enfez), conf.int=TRUE))\n\nsummary(fit_all)\n\n     estudo         term              estimate       std.error      \n Min.   : 1.0   Length:44          Min.   :-1841   Min.   :  87.82  \n 1st Qu.: 6.0   Class :character   1st Qu.: -983   1st Qu.: 186.21  \n Median :11.5   Mode  :character   Median : 1560   Median : 299.40  \n Mean   :11.5                      Mean   : 3544   Mean   : 437.53  \n 3rd Qu.:17.0                      3rd Qu.: 7964   3rd Qu.: 524.35  \n Max.   :22.0                      Max.   :12932   Max.   :2364.95  \n   statistic           p.value            conf.low          conf.high      \n Min.   :-12.2155   Min.   :0.000000   Min.   :-20157.4   Min.   :-1279.5  \n 1st Qu.: -6.0334   1st Qu.:0.000000   1st Qu.: -1511.5   1st Qu.: -634.2  \n Median :  0.1017   Median :0.000000   Median :  -780.3   Median : 4976.7  \n Mean   :  5.2585   Mean   :0.020873   Mean   :  2074.7   Mean   : 5012.4  \n 3rd Qu.: 17.1039   3rd Qu.:0.001008   3rd Qu.:  6218.1   3rd Qu.: 9284.2  \n Max.   : 30.9582   Max.   :0.343542   Max.   : 11798.0   Max.   :27127.4  \n\n\n\nIntercepts &lt;- fit_all |&gt; \n  filter(term == \"(Intercept)\")\n\nSlopes &lt;-  fit_all |&gt; \n  filter(term == \".$enfez\")\n\n\nsummary(Slopes)\n\n     estudo          term              estimate         std.error     \n Min.   : 1.00   Length:22          Min.   :-1841.5   Min.   : 87.82  \n 1st Qu.: 6.25   Class :character   1st Qu.:-1319.9   1st Qu.:131.82  \n Median :11.50   Mode  :character   Median : -984.0   Median :185.22  \n Mean   :11.50                      Mean   :-1017.3   Mean   :207.49  \n 3rd Qu.:16.75                      3rd Qu.: -826.1   3rd Qu.:240.77  \n Max.   :22.00                      Max.   : -365.7   Max.   :534.82  \n   statistic          p.value             conf.low         conf.high      \n Min.   :-12.216   Min.   :0.000e+00   Min.   :-5527.7   Min.   :-1279.5  \n 1st Qu.: -7.736   1st Qu.:0.000e+00   1st Qu.:-1692.5   1st Qu.: -924.9  \n Median : -6.194   Median :6.240e-06   Median :-1486.2   Median : -652.0  \n Mean   : -5.934   Mean   :2.714e-02   Mean   :-1639.3   Mean   : -395.2  \n 3rd Qu.: -3.126   3rd Qu.:1.825e-02   3rd Qu.:-1143.5   3rd Qu.: -214.1  \n Max.   : -1.670   Max.   :3.435e-01   Max.   : -739.2   Max.   : 4243.7  \n\n\n\nb0 &lt;- fit_all |&gt; \n  filter(term == \"(Intercept)\") |&gt; \n  ggplot(aes(x = estimate))+\n  geom_histogram(bins = 15, color = \"black\", fill = \"grey85\", alpha = 0.5, size = 1)+\n  theme_bw()+\n  labs(x = \"Intercept\", y = \"Frequency\") +\n  theme(\n    axis.title.x = element_text(size = 20),\n    axis.title.y = element_text(size = 20),\n    axis.text.x = element_text(size = 16),   \n    axis.text.y = element_text(size = 16))\n\nb1 &lt;- fit_all |&gt; \n  filter(term == \".$enfez\") |&gt; \n  ggplot(aes(x = estimate))+\n  geom_histogram(bins = 15, color = \"black\", fill = \"grey85\", alpha = 0.5, size = 1)+\n    #geom_vline(xintercept = -60.2210    , size = 1.5, linetype = 2, color = \"black\")+\n  theme_bw()+\n  labs(x = \"Slope\", y = \"Frequency\")+\n   theme(\n    axis.title.x = element_text(size = 20), \n    axis.title.y = element_text(size = 20), \n    axis.text.x = element_text(size = 16),   \n    axis.text.y = element_text(size = 16))\n\nFinal figure used in the article\n\nfs1 = (r+z)/(b0+b1) + plot_annotation(tag_levels = \"A\") \nfs1\n\n\n\n\n\n\n\n\n\n\n\nMixed-effects model\nWe fitted a mixed-effects model to estimate the effect of severity on yield, including random slopes and intercepts for each study to account for variation among studies.\n\nmm1 &lt;- lmer(prod ~ sev  + (sev | estudo), data = data1,\n            REML = F)\nsummary(mm1)\n\nLinear mixed model fit by maximum likelihood  ['lmerMod']\nFormula: prod ~ sev + (sev | estudo)\n   Data: data1\n\n      AIC       BIC    logLik -2*log(L)  df.resid \n  20722.4   20753.0  -10355.2   20710.4      1196 \n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.2150 -0.6026 -0.0144  0.6227  3.7796 \n\nRandom effects:\n Groups   Name        Variance Std.Dev. Corr \n estudo   (Intercept) 5989820  2447.4        \n          sev           91896   303.1   -0.51\n Residual             1600914  1265.3        \nNumber of obs: 1202, groups:  estudo, 22\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)  8229.03     554.20   14.85\nsev         -1043.02      83.02  -12.56\n\nCorrelation of Fixed Effects:\n    (Intr)\nsev -0.569\n\n\nWe extracted the variance from the random effects of the mixed-effects model and obtained the residual variance. Using the intercept and slope variances, we calculated τ² (total variance of the random effects) and then computed I² to quantify the proportion of total variability due to heterogeneity between studies.\n\n# Extracting variance from random effects\nrandom_effects_variance &lt;- VarCorr(mm1)\n\n# Accessing the variance/covariance matrix of the 'cod' group\nvar_random_effects &lt;- random_effects_variance$estudo\n\n# Residual variance (error)\nsigma2 &lt;- sigma(mm1)^2\n\n# τ² (variance of random effects)\n# The variance of the intercept is in the first row and column\nvar_intercept &lt;- var_random_effects[1, 1]\n\n# The slope variance is in the second row and column\nvar_slope &lt;- var_random_effects[2, 2]\n\n# Calculate I²\ntau2 &lt;- var_intercept + var_slope  # Total variance of random effects\nI2 &lt;- (tau2 / (tau2 + sigma2)) * 100  # Calculation of I²\n\nI2\n\n[1] 79.1619\n\n\nWe calculate confidence intervals for the mixed-effects model undefinedsing the profile likelihood\n\nconfint(mm1, method = \"profile\")  # Interval based on likelihood profile\n\n                   2.5 %        97.5 %\n.sig01       1789.400627 3512.85093036\n.sig02         -0.807123   -0.01721776\n.sig03        185.017908  478.45047201\n.sigma       1215.490725 1318.54698067\n(Intercept)  7050.872811 9342.37841711\nsev         -1217.903252 -869.23656135\n\n\nData distribution from individual analyses of 22 studies. Blue points represent observed data, and gray lines indicate individual linear regressions.\n\nfig3a &lt;- ggplot() +\n  scale_x_continuous(breaks = 0:5, limits = c(0, 5)) +\n  scale_y_continuous(breaks = seq(0, 14000, by = 2000), limits = c(0, 14000)) +\n  geom_abline(aes(slope = Slopes$estimate, intercept = Intercepts$estimate), \n              size = 1, alpha = 0.5, color = \"darkgray\") +\n geom_point(data = ef_median, aes(x = mean_sev-1, y = mean_yld),\n             color = \"#3A5FCD\", shape = 16, alpha = 0.3) +\n  labs(x = \"Scale score -1\", y = \"Yield (kg/ha)\") +\n  theme_bw() +\n  theme(text = element_text(size = 20),\n        axis.text.x = element_text(size = 18),\n        axis.text.y = element_text(size = 18),\n        plot.title = element_text(hjust = 0.5, size = 18))\nfig3a\n\n\n\n\n\n\n\n\nMeta-analysis using a mixed-effects model. Blue line represents the average estimated relationship (common slope), and black dashed lines indicate the 95% confidence interval for the average regression.\n\nr_regression_misto &lt;- data.frame(\n  estimate = c(8229.026, -1043.024),\n  low = c(7050.872811 , -1217.903252),\n  high = c(9342.37841711, -869.23656135)\n)\n\nfig3b &lt;- ggplot() +\n  scale_x_continuous(breaks = 0:5, limits = c(0, 5)) +\n  scale_y_continuous(breaks = seq(0, 14000, by = 2000), limits = c(0, 14000)) +\n  geom_abline(data = r_regression_misto, \n              aes(slope = estimate[2], intercept = estimate[1]), \n              size = 1.5, color = \"#3A5FCD\") +\n  geom_abline(data = r_regression_misto, \n              aes(intercept = high[1], slope = high[2]), \n              size = 1.2, linetype = 2) +\n  geom_abline(data = r_regression_misto, \n              aes(intercept = low[1], slope = low[2]), \n              size = 1.2, linetype = 2) +\n  labs(x = \"Scale score -1\", y = \"Yield (kg/ha)\") +\n  theme_bw() +\n  theme(text = element_text(size = 20),\n        axis.text.x = element_text(size = 18),\n        axis.text.y = element_text(size = 18),\n        plot.title = element_text(hjust = 0.5, size = 18))\nfig3b\n\n\n\n\n\n\n\n\nCalculation of damage when the disease reaches the maximum severity score.\n\n# 8229.026   -1043.024 \ny1 = 8229.03\n\ny6 = 8229.03 + (-1043.02 * 5)\n\n\nmax_damage = ((y1 - y6) / y1) * 100\nmax_damage\n\n[1] 63.37442\n\n\nCalculation of the damage coefficient\n\nper_unit_loss = -1043.024 / y1 * 100\nper_unit_loss\n\n[1] -12.67493\n\n\n\n\nCreation of susceptibility levels\nWe fitted a mixed-effects model for severity, considering random effects of hybrid, year, study, and their interaction, and extracted BLUPs for each hybrid. The BLUPs were scaled, and a Euclidean distance matrix was calculated to perform hierarchical clustering using Ward’s method. The dendrogram was cut into two groups, classifying hybrids with higher BLUPs as susceptible and those with lower BLUPs as moderately susceptible, and the results were visualized for interpretation.\n\n# Ensure factors\ndf &lt;- data1 |&gt; \n  mutate(\n    HYBRID = as.factor(cultivar),\n    YEAR = as.factor(ano),\n    LOC = as.factor(estudo),\n    REP = as.factor(rep)\n  )\n\n# Fit mixed model: random effect for HYBRID, optionally random LOC:YEAR\nmodel &lt;- lmer(sev ~ (1|HYBRID) + (1|YEAR) + (1|LOC) + (1|LOC:YEAR), data = df)\n\nblups &lt;- ranef(model)$HYBRID |&gt; \n  rownames_to_column(\"HYBRID\") |&gt; \n  rename(BLUP = '(Intercept)') |&gt; \n  arrange(BLUP)\n\nblups2 &lt;- ranef(model)$HYBRID |&gt; \n  rownames_to_column(\"HYBRID\") |&gt; \n  rename(BLUP = '(Intercept)') |&gt; \n  arrange(BLUP)\n\n# Assuming 'blups' contains HYBRID and BLUP columns from lmer\nblup_matrix &lt;- blups |&gt; \n  column_to_rownames(\"HYBRID\")\n\n# Scale the BLUPs (optional but common in clustering)\nblup_scaled &lt;- scale(blup_matrix)\n\n# Compute distance and apply hierarchical clustering\ndist_blup &lt;- dist(blup_scaled)\nclust &lt;- hclust(dist_blup, method = \"ward.D2\")\n\n# Cut the tree into 2 groups\nblups$GROUP &lt;- cutree(clust, k = 2)\n\n# Optional: sort for interpretation\nblups &lt;- blups  |&gt; \n  arrange(BLUP) |&gt; \n  mutate(cultivar = HYBRID) |&gt; \n  select(cultivar, GROUP)\n\nblups_final &lt;- left_join(blups, blups2, by = c(\"cultivar\" = \"HYBRID\"))\n\n\n# View the clustered groups\nprint(blups)\n\n          cultivar GROUP\n1     AGN 2M40PRO4     1\n2     AG 9035 PRO3     1\n3    XGEN 2102PRO3     1\n4     AGN 2M66PRO3     1\n5     AGN 2M88PRO3     1\n6     AGN 2M77PRO3     1\n7        20A38VIP3     1\n8         DGX20S01     1\n9        FS 700PWU     1\n10    XGEN 2959 RR     1\n11        DGX20T20     1\n12       P3282 VYH     1\n13 STINE 9801 VIP3     1\n14    AG 8701 PRO4     1\n15    VA 22DM PRO4     1\n16       B2401 PWU     1\n17      K7510 VIP3     1\n18        MG 408WU     1\n19      K7500 VIP3     1\n20    XGEN 3868 RR     1\n21      FS 575 PWU     1\n22    DKB 360 PRO3     1\n23    AS 1800 PRO4     1\n24       XGEN 2959     1\n25      HBR1023 EX     1\n26          SX3193     1\n27      MG 593 PWU     1\n28     STATUS VIP3     1\n29        DGX20S90     1\n30        BALU 761     1\n31       BALU 1983     1\n32        Exp B003     2\n33      BLV2223 EX     2\n34       XGEN 3668     2\n35    AGN 2M01PRO3     2\n36    SUPREMO VIP3     2\n37  XGEN 2106 PRO3     2\n38 STINESZ7634VIP3     2\n39    AGN 2M60PRO3     2\n40         PC 1203     2\n41        Exp B001     2\n42        Exp B004     2\n43       B2620 PWU     2\n44       10A40VIP3     2\n45    DKB 260 PRO4     2\n46    AS 1844 PRO4     2\n47    AG 9035 PRO4     2\n48    P3707 Leptra     2\n49        DGX20D23     2\n50           PH617     2\n51     VA 19A VIP3     2\n52        AGN 2M03     2\n53    AS 1800 PRO3     2\n54      BLV3623 EX     2\n55    AG 8480 PRO4     2\n56         IPR 216     2\n57    DKB 255 PRO4     2\n58      K9606 VIP3     2\n59    VA 16DM PRO4     2\n60          SX3517     2\n61         JM 2M60     2\n62      AGR VEREDA     2\n63        Exp B002     2\n64         IPR 127     2\n65        Exp B005     2\n66    DKB 265 PRO3     2\n67    AG 8065 PRO4     2\n68    DKB 265 PRO4     2\n69     DKB380 PRO3     2\n70       30A37 PWU     2\n71 STINE 9504 VIP3     2\n72 STINESX3279VIP3     2\n\nfig_blups &lt;- factoextra::fviz_dend(\n  clust,\n  k = 2,                                # number of groups\n  rect = FALSE,                          # draw rectangles around groups\n  rect_fill = TRUE,                     # fill the rectangles\n  rect_border = \"gray30\",              # color of the rectangle borders\n  cex = 0.8,                            # size of the label text\n  k_colors = c(\"#3A5FCD\", \"red\"),      # colors of the groups\n  color_labels_by_k = TRUE,            # color labels according to groups\n  labels_track_height = 0.8,           # height of the label track\n  horiz = TRUE,\n  main = \" \",\n  ) +  labs(y = \"Euclidean distance \") +\n  theme(axis.text.x = element_text(size = 18),\n        axis.title.x = element_text(size = 20) # increase numbers on the Y axis\n  ) +\n  theme_bw()\nprint(fig_blups)\n\n\n\n\n\n\n\n\nData preparation\n\ndata2 &lt;- left_join(data1, blups)\n\n\ndata3 &lt;- data2 |&gt; \n  group_by(estudo, tolerance_ad, cultivar, GROUP, prod_class) |&gt; \n  summarize(sev = mean(sev),\n            prod = mean(prod))\n\n\n# Fit random coefficients model: varying intercept and slope by STUDY\n\ndf &lt;- data3 |&gt; \n  mutate(GROUP = factor(GROUP),\n         STUDY = factor(estudo))  # If not already a factor\n\n\nmodel0 &lt;- lmer(prod ~ sev  + (sev | STUDY), data = df)\nmodel &lt;- lmer(prod ~ sev * GROUP + (sev | STUDY), data = df)\nanova(model0, model)\n\nData: df\nModels:\nmodel0: prod ~ sev + (sev | STUDY)\nmodel: prod ~ sev * GROUP + (sev | STUDY)\n       npar   AIC   BIC  logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)    \nmodel0    6 12026 12054 -6007.1     12014                         \nmodel     8 11998 12035 -5991.2     11982 31.856  2  1.209e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\ncar::Anova(model)\n\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: prod\n             Chisq Df Pr(&gt;Chisq)    \nsev       127.9240  1  &lt; 2.2e-16 ***\nGROUP      32.7567  1  1.044e-08 ***\nsev:GROUP   0.1632  1     0.6862    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n# Random effect structure\nranef(model)\n\n$STUDY\n   (Intercept)         sev\n1   -1459.1137   15.284983\n2   -1991.7467   57.176595\n3   -1980.4028  128.936660\n4   -2723.3699   94.332697\n5      76.4069 -106.160268\n6   -1209.7578    8.740392\n7   -1763.9330  159.938874\n8   -1761.4997   17.323846\n9    -775.7479 -108.880939\n10  -1529.2055   22.682723\n11  -2491.4219   42.865181\n12  -2571.9672   38.663867\n13   2307.6836  -11.033790\n14   -708.2445  231.258163\n15  -1180.3540  235.275963\n16   2342.6513   88.347633\n17   2695.6816   -1.555937\n18   1731.2943  -48.313774\n19   3713.3190 -372.130391\n20   4574.9393 -142.132894\n21   3840.1462 -166.092931\n22    864.6426 -184.526651\n\nwith conditional variances for \"STUDY\" \n\n# Optional: extract slope and intercept per STUDY\ncoef(model)$STUDY\n\n   (Intercept)        sev   GROUP1 sev:GROUP1\n1     6272.781  -956.9583 547.8574   38.56584\n2     5740.148  -915.0667 547.8574   38.56584\n3     5751.492  -843.3066 547.8574   38.56584\n4     5008.525  -877.9106 547.8574   38.56584\n5     7808.302 -1078.4035 547.8574   38.56584\n6     6522.137  -963.5029 547.8574   38.56584\n7     5967.962  -812.3044 547.8574   38.56584\n8     5970.395  -954.9194 547.8574   38.56584\n9     6956.147 -1081.1242 547.8574   38.56584\n10    6202.690  -949.5606 547.8574   38.56584\n11    5240.473  -929.3781 547.8574   38.56584\n12    5159.928  -933.5794 547.8574   38.56584\n13   10039.579  -983.2771 547.8574   38.56584\n14    7023.651  -740.9851 547.8574   38.56584\n15    6551.541  -736.9673 547.8574   38.56584\n16   10074.546  -883.8956 547.8574   38.56584\n17   10427.577  -973.7992 547.8574   38.56584\n18    9463.189 -1020.5570 547.8574   38.56584\n19   11445.214 -1344.3737 547.8574   38.56584\n20   12306.834 -1114.3762 547.8574   38.56584\n21   11572.041 -1138.3362 547.8574   38.56584\n22    8596.538 -1156.7699 547.8574   38.56584\n\n\n\n\nModerators\n\nSusceptibility levels used as a moderator\nAdding the interaction between severity and susceptibility group did not improve the model fit, indicating that severity affects production similarly across groups.\n\n# susceptibility levels\n\nmodel_full &lt;- lmer(prod ~ sev * GROUP + (sev | STUDY), data = df)\nmodel_no_interaction &lt;- lmer(prod ~ sev + GROUP + (sev | STUDY), data = df)\nmodel_no_group &lt;- lmer(prod ~ sev + (sev | STUDY), data = df)\nanova(model_no_group, model_no_interaction, model_full)\n\nData: df\nModels:\nmodel_no_group: prod ~ sev + (sev | STUDY)\nmodel_no_interaction: prod ~ sev + GROUP + (sev | STUDY)\nmodel_full: prod ~ sev * GROUP + (sev | STUDY)\n                     npar   AIC   BIC  logLik -2*log(L)   Chisq Df Pr(&gt;Chisq)\nmodel_no_group          6 12026 12054 -6007.1     12014                      \nmodel_no_interaction    7 11996 12028 -5991.3     11982 31.6657  1  1.831e-08\nmodel_full              8 11998 12035 -5991.2     11982  0.1907  1     0.6623\n                        \nmodel_no_group          \nmodel_no_interaction ***\nmodel_full              \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\n\nTolerance group used as a moderator\nAdding the interaction between severity andtolerance group did not improve the model fit, indicating that severity affects production similarly across groups.\n\n# tolerance group\ndf2 &lt;- data1 |&gt; \n  mutate(tolerance_ad = factor(tolerance_ad),\n         estudo = factor(estudo))\n\nmodel_full &lt;- lmer(prod ~ sev * tolerance_ad + (sev | estudo), data = df2)\nmodel_no_interaction &lt;- lmer(prod ~ sev + tolerance_ad + (sev | estudo), data = df2)\nmodel_no_group &lt;- lmer(prod ~ sev + (sev | estudo), data = df2)\nanova(model_no_group, model_no_interaction, model_full)\n\nData: df2\nModels:\nmodel_no_group: prod ~ sev + (sev | estudo)\nmodel_no_interaction: prod ~ sev + tolerance_ad + (sev | estudo)\nmodel_full: prod ~ sev * tolerance_ad + (sev | estudo)\n                     npar   AIC   BIC logLik -2*log(L)   Chisq Df Pr(&gt;Chisq)\nmodel_no_group          6 20722 20753 -10355     20710                      \nmodel_no_interaction    7 20649 20684 -10317     20635 75.7620  1     &lt;2e-16\nmodel_full              8 20651 20691 -10317     20635  0.0031  1     0.9558\n                        \nmodel_no_group          \nmodel_no_interaction ***\nmodel_full              \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\n\nYield class used as a moderator\nAdding the interaction between severity and yield class improved the model fit.\n\n# prod class\ndf3 &lt;- data1 |&gt; \n  mutate(prod_class = factor(prod_class),\n         estudo = factor(estudo))  # If not already a factor\n\nmodel_full &lt;- lmer(prod ~ sev * prod_class + (sev | estudo), data = df3)\nmodel_no_interaction &lt;- lmer(prod ~ sev + prod_class + ( sev | estudo), data = df3)\nmodel_no_group &lt;- lmer(prod ~ sev + (sev | estudo), data = df3)\nanova(model_no_group, model_no_interaction, model_full)\n\nData: df3\nModels:\nmodel_no_group: prod ~ sev + (sev | estudo)\nmodel_no_interaction: prod ~ sev + prod_class + (sev | estudo)\nmodel_full: prod ~ sev * prod_class + (sev | estudo)\n                     npar   AIC   BIC logLik -2*log(L)   Chisq Df Pr(&gt;Chisq)\nmodel_no_group          6 20722 20753 -10355     20710                      \nmodel_no_interaction    7 20116 20151 -10051     20102 608.883  1    &lt; 2e-16\nmodel_full              8 20112 20153 -10048     20096   5.446  1    0.01961\n                        \nmodel_no_group          \nmodel_no_interaction ***\nmodel_full           *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nsummary(model_full)\n\nLinear mixed model fit by REML ['lmerMod']\nFormula: prod ~ sev * prod_class + (sev | estudo)\n   Data: df3\n\nREML criterion at convergence: 20051.1\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.2730 -0.6356 -0.0159  0.6439  4.1690 \n\nRandom effects:\n Groups   Name        Variance Std.Dev. Corr \n estudo   (Intercept) 2620833  1618.9        \n          sev          105486   324.8   -0.65\n Residual              965838   982.8        \nNumber of obs: 1202, groups:  estudo, 22\n\nFixed effects:\n                   Estimate Std. Error t value\n(Intercept)         6867.64     391.35  17.549\nsev                 -868.14      87.51  -9.920\nprod_classalta      2160.70     193.39  11.173\nsev:prod_classalta   197.18      79.55   2.479\n\nCorrelation of Fixed Effects:\n            (Intr) sev    prd_cl\nsev         -0.723              \nprod_clsslt -0.245  0.356       \nsv:prd_clss  0.197 -0.344 -0.882\n\n\nGraphical visualization of how yield class affects the relationship as a moderating variable.\n\nfig_pc1 &lt;- data3 |&gt; \n  ggplot(aes(sev + 1, prod, color = factor(prod_class))) +\n  scale_color_manual(\n    name = \"Yield Class\", \n    values = c(\"baixa\" = \"#ff9688\", \"alta\" = \"#3A5FCD\"),\n    labels = c(\"baixa\" = \"Low\", \"alta\" = \"High\")\n  ) +\n  theme_bw()+\n  geom_point() +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  facet_wrap(~estudo)+\n  labs(y = \"Yield (Kg/ha)\",x = \"Severity score\")\n\nfig_pc1\n\n\n\n\n\n\n\n\n\n\nSeverity class used as a moderator\nAdding the interaction between severity and severity class did not improve the model fit, indicating that severity affects production similarly across groups.\n\n#sev class\nmed_sev &lt;- sev_dif |&gt; \n  summarise(med_sev = median(enfez, na.rm = TRUE)) |&gt; \n  pull(med_sev)\n\ndf4 &lt;- data1 |&gt; \n  mutate(sev_class = factor(ifelse(sev &gt; med_sev, \"alta\", \"baixa\")))\n\nmodel_full &lt;- lmer(prod ~ sev * sev_class + (sev | estudo), data = df4)\nmodel_no_interaction &lt;- lmer(prod ~ sev + sev_class + (sev | estudo), data = df4)\nmodel_no_group &lt;- lmer(prod ~ sev + (sev | estudo), data = df4)\nanova(model_no_group, model_no_interaction, model_full)\n\nData: df4\nModels:\nmodel_no_group: prod ~ sev + (sev | estudo)\nmodel_no_interaction: prod ~ sev + sev_class + (sev | estudo)\nmodel_full: prod ~ sev * sev_class + (sev | estudo)\n                     npar   AIC   BIC logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)\nmodel_no_group          6 20722 20753 -10355     20710                     \nmodel_no_interaction    7 20724 20760 -10355     20710 0.4696  1     0.4932\nmodel_full              8 20725 20766 -10355     20709 0.6369  1     0.4248\n\n\n\n\nFoliar spot pressure used as a moderator\nAdding the interaction between severity and foliar spot pressure did not improve the model fit, indicating that severity affects production similarly across groups.\n\n#foliar spot pressure\nmed_spots &lt;- sev_dif |&gt; \n  summarise(med_spots = median(manchas_totais, na.rm = TRUE)) |&gt; \n  pull(med_spots)\n\ndf5 &lt;- sev_dif |&gt; \n  mutate(spot_press = factor(ifelse(manchas_totais &gt; med_spots, \"alta\", \"baixa\")))\n\nmodel_full &lt;- lmer(prod ~ enfez * spot_press + (enfez | estudo), data = df5)\nmodel_no_interaction &lt;- lmer(prod ~ enfez + spot_press + (enfez | estudo), data = df5)\nmodel_no_group &lt;- lmer(prod ~ enfez + (enfez | estudo), data = df5)\nanova(model_no_group, model_no_interaction, model_full)\n\nData: df5\nModels:\nmodel_no_group: prod ~ enfez + (enfez | estudo)\nmodel_no_interaction: prod ~ enfez + spot_press + (enfez | estudo)\nmodel_full: prod ~ enfez * spot_press + (enfez | estudo)\n                     npar   AIC   BIC logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)\nmodel_no_group          6 20722 20753 -10355     20710                     \nmodel_no_interaction    7 20724 20760 -10355     20710 0.1424  1     0.7059\nmodel_full              8 20726 20767 -10355     20710 0.0677  1     0.7947\n\n\n\n\n\nHow does yield class affect corn production?\nWe adjusted the model coefficients for the high- and low-productivity classes and then calculated the damage coefficient for each of them.\n\nintercept_baixa &lt;- 6867.64\nslope_baixa &lt;- -868.14\n\nintercept_alta &lt;- intercept_baixa + 2160.70\nslope_alta &lt;- slope_baixa + 197.18\n\npul_baixa = (slope_baixa/intercept_baixa) * 100\npul_alta = (slope_alta) / (intercept_alta) * 100\n\npul_baixa\n\n[1] -12.64102\n\npul_alta\n\n[1] -7.431709\n\n\nThe confidence interval was calculated.\n\nconfint(model_full)\n\n                              2.5 %        97.5 %\n.sig01                 1789.7010505  3.522977e+03\n.sig02                   -0.8063361 -7.518602e-03\n.sig03                  184.4886849  4.780633e+02\n.sigma                 1215.3065780  1.318352e+03\n(Intercept)            7024.8446536  9.347710e+03\nenfez                 -1220.2665783 -8.469110e+02\nspot_pressbaixa        -385.4771558  4.085676e+02\nenfez:spot_pressbaixa  -159.5662101  1.222199e+02\n\n\nAll of the above information was transformed into a graph for better visualization.\n\n# Confidence intervals that you obtained\nci &lt;- tribble(\n  ~term,                ~low,          ~high,\n  \"(Intercept)\",        6060.447,      7647.010,\n  \"sev\",               -1049.560,     -697.426,\n  \"prod_classalta\",     1756.064,      2558.214,\n  \"sev:prod_classalta\",   32.024,       366.974\n)\n\n# Sequence of severity\nsev_seq &lt;- seq(0, 5, length.out = 100)\n\n# ---- Low productivity ----\nintercept_baixa_low  &lt;- ci$low[ci$term==\"(Intercept)\"]\nintercept_baixa_high &lt;- ci$high[ci$term==\"(Intercept)\"]\nslope_baixa_low      &lt;- ci$low[ci$term==\"sev\"]\nslope_baixa_high     &lt;- ci$high[ci$term==\"sev\"]\n\ndf_baixa &lt;- tibble(\n  sev = sev_seq,\n  fit_low  = intercept_baixa_low  + slope_baixa_low  * sev,\n  fit_high = intercept_baixa_high + slope_baixa_high * sev,\n  prod_class = \"Low\"\n)\n\n# ---- High productivity ----\nintercept_alta_low  &lt;- intercept_baixa_low  + ci$low[ci$term==\"prod_classalta\"]\nintercept_alta_high &lt;- intercept_baixa_high + ci$high[ci$term==\"prod_classalta\"]\nslope_alta_low      &lt;- slope_baixa_low  + ci$low[ci$term==\"sev:prod_classalta\"]\nslope_alta_high     &lt;- slope_baixa_high + ci$high[ci$term==\"sev:prod_classalta\"]\n\ndf_alta &lt;- tibble(\n  sev = sev_seq,\n  fit_low  = intercept_alta_low  + slope_alta_low  * sev,\n  fit_high = intercept_alta_high + slope_alta_high * sev,\n  prod_class = \"High\"\n)\n\n# Combine everything\ndf_all &lt;- bind_rows(df_baixa, df_alta)\n\n# Plot the graph\nYc_plot &lt;- ggplot(df_all, aes(x = sev, color = prod_class, fill = prod_class)) +\n  geom_ribbon(aes(ymin = fit_low, ymax = fit_high), alpha = 0.2, color = NA) +\n  geom_line(aes(y = (fit_low + fit_high)/2), size = 1.5) +\n  scale_color_manual(values = c(\"Low\" = \"red\", \"High\" = \"#3A5FCD\")) +\n  scale_fill_manual(values = c(\"Low\" = \"red\", \"High\" = \"#3A5FCD\")) +\n  scale_x_continuous(breaks = 0:5, limits = c(0, 5)) +\n  scale_y_continuous(breaks = seq(0, 12000, by = 2000), limits = c(0, 12000)) +\n  labs(\n    x = \"Scale score -1\", \n    y = \"Yield (kg/ha)\",\n    color = \"Yield class\",\n    fill  = \"Yield class\"\n  ) +\n  theme_bw(base_size = 18) +\n  theme(\n     panel.grid.minor = element_blank(),\n    text = element_text(size = 20),\n    axis.text.x = element_text(size = 18),\n    axis.text.y = element_text(size = 18),\n    legend.position = \"top\",\n    plot.title = element_text(hjust = 0.5, size = 18)\n  ) +\n  annotate(\"text\", x = 1.5, y = 10300, label = \"DC: -7.43%\", color = \"#3A5FCD\", hjust = 0) +\n  annotate(\"text\", x = 1, y = 3000, label = \"DC: -12.64%\", color = \"red\", hjust = 0)\n\nYc_plot\n\n\n\n\n\n\n\n\nA graph was created showing the relative yield loss (%) as a function of disease severity.\n\n# Definitions of the mean DCs (as you already noted)\ndc_high &lt;- -7.43   # %\ndc_low  &lt;- -12.64  # %\n\n# Sequence of severity\nsev_seq &lt;- 0:5\n\n# Create dataframe for plotting\ndf_rel &lt;- tibble(\n  sev = rep(sev_seq, 2),\n  DC  = c(dc_low * sev_seq, dc_high * sev_seq),   # cumulative loss\n  prod_class = rep(c(\"Low\", \"High\"), each = length(sev_seq))\n)\n\n# Relative plot\nDC_plot &lt;- ggplot(df_rel, aes(x = sev, y = DC, color = prod_class)) +\n  geom_line(size = 1.5) +\n  geom_point(size = 3) +\n  scale_color_manual(values = c(\"Low\" = \"red\", \"High\" = \"#3A5FCD\")) +\n  scale_x_continuous(breaks = 0:5, limits = c(0, 5)) +\n  labs(\n    x = \"Scale score -1\",\n    y = \"Relative Yield Loss (%)\",\n    color = \"Yield class\"\n  ) +\n  theme_bw(base_size = 18) +\n  theme(\n    legend.position = \"top\",\n    axis.text.x = element_text(size = 16),\n    axis.text.y = element_text(size = 16)\n  ) +\n  annotate(\"text\", x = 5, y = dc_high*5, \n           label = paste0(\"Max RYL: \", dc_high*5, \"%\"), color = \"#3A5FCD\", hjust = 1, vjust = -5) +\n  annotate(\"text\", x = 5, y = dc_low*5, \n           label = paste0(\"Max RYL: \", dc_low*5, \"%\"), color = \"red\", hjust = 1.4, vjust = 0.1)\n\nDC_plot\n\n\n\n\n\n\n\n\nDue to the observed difference, we investigated whether plants from different yield classes exhibited distinct severity distributions through a density plot.\n\nden_ydcl &lt;- ggplot(data3, aes(x = sev + 1, fill = prod_class)) +\n  geom_density(alpha = 0.5) +\n  scale_fill_manual(values = c(\"baixa\" = \"#ff9688\", \"alta\" = \"#3A5FCD\"), \n                     labels = c(\"baixa\" = \"Low\", \"alta\" = \"High\")) +\n  scale_x_continuous(limits = c(1, 6), breaks = seq(1, 6, 1)) +\n  labs(\n    x = \"Scale score -1\",\n    y = \"Density\",\n    fill = \"Yield Class\"\n  ) +\n  theme_bw()\nden_ydcl"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "How Much Yield Loss Is Caused by the Corn Stunt Disease Complex?",
    "section": "",
    "text": "Explore our collection of carefully documented R scripts, designed to make it easy to replicate the analyses from our study on modeling yield losses caused by the corn stunt disease complex.\nA preprint version of this work is available here."
  },
  {
    "objectID": "index.html#abstract",
    "href": "index.html#abstract",
    "title": "How Much Yield Loss Is Caused by the Corn Stunt Disease Complex?",
    "section": "Abstract",
    "text": "Abstract\nHistorically considered of secondary importance, the corn stunt disease complex, caused by mollicutes and viruses, has recently become an increasing concern in Brazil. In this study, we assessed the relationship between disease severity (1–6 ordinal scale) and corn yield (kg/ha). Data from 22 independent field trials conducted across 10 municipalities in Paraná over two seasons were analyzed. The data were combined using a mixed-effects model to estimate both the attainable yield and the yield decline rate associated with disease severity. Heterogeneity among studies was explored through the influence of four moderator variables: yield class, severity class, hybrid tolerance, and hybrid susceptibility. Only yield class significantly explained variation among studies. The estimated global attainable yield was 8,229.03 kg/ha, with a yield decline rate of −1,043 kg per unit increase in disease score. On average, each additional point on the severity scale corresponded to a -12.3% yield reduction, reaching up to -63% at the highest severity level. However, for low-yield hybrids, the model estimates a −12.6% reduction per severity point, whereas for high-yield hybrids, the reduction was −7.4% per point. These findings highlight the substantial impact of the corn stunt disease complex on yield."
  },
  {
    "objectID": "index.html#about-me",
    "href": "index.html#about-me",
    "title": "How Much Yield Loss Is Caused by the Corn Stunt Disease Complex?",
    "section": "About me",
    "text": "About me\n\n\n\nI’m Marcelo Gonçalves, a Brazilian PhD candidate in Plant Pathology (UFV). I have conducted research in the molecular and population biology of plant viruses. Nowadays, I am using modeling and remote sensing to study the epidemiology of the corn stunt complex disease, caused by viruses and mollicutes."
  },
  {
    "objectID": "index.html#contact",
    "href": "index.html#contact",
    "title": "How Much Yield Loss Is Caused by the Corn Stunt Disease Complex?",
    "section": "Contact",
    "text": "Contact\nIf you find any errors in the code or have any questions, send me an email at marcelo.h.goncalves@ufv.br or connect with me on\nGitHub |\nLinkedIn |\nInstagram |\nX (Twitter)"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "mapa2.html",
    "href": "mapa2.html",
    "title": "Modeling of yield losses caused by the corn stunt disease complex",
    "section": "",
    "text": "Dependencies\nLet’s load all the packages we will use in the map creation\n\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(rnaturalearth)\nlibrary(rnaturalearthhires)\nlibrary(ggrepel)\nlibrary(ggspatial)\nlibrary(cowplot)\n\n\n\nCoordinates\nCreate the data frame with the studies and coordinates\n\ndados &lt;- tribble(\n  ~Trial, ~Municipality, ~Year, ~Latitude, ~Longitude,\n   1, \"Cambará\", 2022, -23.0466, -50.0750,\n   2, \"Cambará\", 2022, -23.0466, -50.0750,\n   3, \"Campo Mourão\", 2022, -24.0469, -52.3780,\n   4, \"Campo Mourão\", 2022, -24.0469, -52.3780,\n   5, \"Londrina\", 2022, -23.3045, -51.1696,\n   6, \"Londrina\", 2022, -23.3045, -51.1696,\n   7, \"Palotina\", 2022, -24.2836, -53.8406,\n   8, \"Palotina\", 2022, -24.2836, -53.8406,\n   9, \"Santa Helena\", 2022, -24.8583, -54.3366,\n  10, \"Santa Helena\", 2022, -24.8583, -54.3366,\n  11, \"Santa Tereza do Oeste\", 2022, -25.0540, -53.6275,\n  12, \"Santa Tereza do Oeste\", 2022, -25.0540, -53.6275,\n  13, \"Londrina\", 2023, -23.3045, -51.1696,\n  14, \"Primeiro de Maio\", 2023, -22.8515, -51.0290,\n  15, \"Cambará\", 2023, -23.0466, -50.0750,\n  16, \"Sabáudia\", 2023, -23.3152, -51.5554,\n  17, \"Ibiporã\", 2023, -23.2659, -51.0520,\n  18, \"Campo Mourão\", 2023, -24.0469, -52.3780,\n  19, \"Palotina\", 2023, -24.2836, -53.8406,\n  20, \"Medianeira\", 2023, -25.2971, -54.0942\n)\n\n\nBRA &lt;- ne_states(country = \"Brazil\",\n                 returnclass = \"sf\")\nARG &lt;- ne_states(country = \"Argentina\",\n                 returnclass = \"sf\")\nPRG &lt;- ne_states(country = \"Paraguay\",\n                 returnclass = \"sf\")\n\n# Now extract the state\n# Use unique(BRA$name) to see the names of the states\n\nunique(BRA$name)\n\n [1] \"Rio Grande do Sul\"   \"Roraima\"             \"Pará\"               \n [4] \"Acre\"                \"Amapá\"               \"Mato Grosso do Sul\" \n [7] \"Paraná\"              \"Santa Catarina\"      \"Amazonas\"           \n[10] \"Rondônia\"            \"Mato Grosso\"         \"Maranhão\"           \n[13] \"Piauí\"               \"Ceará\"               \"Rio Grande do Norte\"\n[16] \"Paraíba\"             \"Pernambuco\"          \"Alagoas\"            \n[19] \"Sergipe\"             \"Bahia\"               \"Espírito Santo\"     \n[22] \"Rio de Janeiro\"      \"São Paulo\"           \"Goiás\"              \n[25] \"Distrito Federal\"    \"Minas Gerais\"        \"Tocantins\"          \n\nPR &lt;- BRA[BRA$name_en == \"Paraná\", ]\n\n# Group by location and count the number of studies\nresumo_locais &lt;- dados %&gt;%\n  group_by(Municipality, Latitude, Longitude) %&gt;%\n  summarise(n = n(), .groups = \"drop\")\n\nfig1 &lt;- ggplot() +\n  # Brazil map in the background, with a light fill color\n  geom_sf(data = BRA, fill = \"gray90\", color = \"gray60\") +\n  geom_sf(data = ARG, fill = \"gray90\", color = \"gray60\") +\n  geom_sf(data = PRG, fill = \"gray90\", color = \"gray60\") +\n  \n  # Paraná overlaid in white\n  geom_sf(data = PR, fill = \"white\", color = \"black\", linewidth = 0.4) +\n  \n  # Points\n  geom_point(data = resumo_locais,\n             aes(x = Longitude, y = Latitude, size = n),\n             color = \"#3A5FCD\", alpha = 0.7) +\n  \n  # label\n  geom_label_repel(data = resumo_locais,\n                   aes(x = Longitude, y = Latitude, label = Municipality),\n                   size = 3, fontface = \"bold\",\n                   max.overlaps = Inf,\n                   fill = \"white\",\n                   color = \"black\",\n                   label.size = 0.5,\n                   segment.size = 0.3,\n                   point.padding = 0.3,\n                   force = 5,\n                   nudge_y = 0.25) +\n  \n  # Size legend\n  scale_size_continuous(\n    name = \"No. of trials\",\n    range = c(3, 8),\n    breaks = c(1, 2, 3),\n    guide = guide_legend(override.aes = list(alpha = 1))\n  ) +\n  \n  # Visualization limits\n  coord_sf(xlim = c(-55, -48), ylim = c(-27, -22), expand = FALSE) +\n   annotation_north_arrow(location = \"bl\", which_north = \"true\",\n                         style = north_arrow_fancy_orienteering)+\n  \n  theme_bw()\n\nfig1\n\n\n\n\n\n\n\n\n\n\n\n\n# Map of Brazil with Paraná highlighted\ninset_map &lt;- ggplot() +\n  geom_sf(data = BRA, fill = \"gray90\", color = \"gray80\") +\n  geom_sf(data = PR, fill = \"white\", color = \"black\", linewidth = 0.3) +\n  coord_sf(xlim = c(-75, -34), ylim = c(-34, 6), expand = FALSE) +\n  theme_void() +\n  theme(panel.border = element_rect(color = \"black\", fill = NA, linewidth = 0.8))\n\ninset_map\n\n\n\n\n\n\n\n\n\nfinal_map &lt;- ggdraw() +\n  draw_plot(fig1) +  # Main map\n  draw_plot(inset_map, \n            x = 0.77, y = 0.70,    # Top-left corner position\n            width = 0.24, height = 0.24)  # inset size\n\nfinal_map"
  }
]